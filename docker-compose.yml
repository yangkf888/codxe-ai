version: '3.8'
services:
  redis:
    image: redis:7-alpine
    container_name: ai-video-redis
    restart: always
    ports:
      - "6399:6379"
    volumes:
      - redis_data:/data

  backend:
    build: ./server
    container_name: ai-video-backend
    restart: always
    environment:
      - PORT=8787
      - REDIS_URL=${REDIS_URL:-redis://redis:6379}
      - KIE_API_KEY=${KIE_API_KEY}
      - APP_TOKEN=${APP_TOKEN}
      - PUBLIC_BASE_URL=${PUBLIC_BASE_URL}
      - ADMIN_USERNAME=${ADMIN_USERNAME}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD}
      - FILES_DIR=/app/files
      - PUBLIC_FILES_PATH=/files
    volumes:
      - ./server/files:/app/files
      - ./server/public/uploads:/app/public/uploads
    depends_on:
      - redis

  frontend:
    build:
      context: ./web
      dockerfile: Dockerfile
    container_name: ai-video-frontend
    restart: always
    ports:
      - "${APP_PORT:-8090}:80"
    volumes:
      - ./server/files:/usr/share/nginx/html/files
      - ./server/public/uploads:/usr/share/nginx/html/uploads
      - ./nginx-docker.conf:/etc/nginx/conf.d/default.conf
    depends_on:
      - backend

volumes:
  redis_data:
